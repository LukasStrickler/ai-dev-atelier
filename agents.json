{
  "$schema": "https://opencode.ai/agents.json",
  "_comment": "Agent definitions for OpenCode. Injected into opencode.json by install.sh. Uses blocklist approach: allow by default, block genuinely dangerous commands. Research sources: GTFOBins, Trail of Bits 2025, Backslash Security, CVE-2025-54136 (MCPoison). NOTE: Pattern matching has inherent limitations (space variations, glued pipes, subshells). Pipe patterns catch common cases but are not exhaustive. Security also relies on sandboxing, code review, and agent behavior constraints.",
  "agents": {
    "pr-comment-reviewer": {
      "description": "Subagent for resolve-pr-comments skill. Validates bot review comments (CodeRabbit, Copilot, Gemini) on a single cluster file. Phase 0: Plans before acting. Phases 1-3: Research, critical analysis, classification (VALID_FIX, FALSE_POSITIVE, VALID_DEFER, etc). Phase 4-5: Apply minimal fixes, run verification suite (diagnostics, tests, lint, typecheck). Phase 6: Execute resolve/dismiss scripts to close GitHub threads. Returns dual output: Markdown summary + JSON with actions, confidence scores, and deferred items for orchestrator.",
      "mode": "subagent",
      "model": "zai-coding-plan/glm-4.7",
      "steps": 75,
      "temperature": 0.1,
      "prompt": "{file:agents/pr-comment-reviewer.md}",
      "tools": {
        "bash": true,
        "interactive_bash": true,
        "read": true,
        "edit": true,
        "write": true,
        "glob": true,
        "grep": true,
        "webfetch": true,
        "lsp_diagnostics": true,
        "lsp_find_references": true,
        "lsp_hover": true,
        "lsp_goto_definition": true
      },
      "permission": {
        "read": "allow",
        "edit": "allow",
        "write": "allow",
        "mcp": "allow",
        "bash": {
          "*": "allow",

          "rm -rf /": "deny",
          "rm -rf /*": "deny",
          "rm -rf ~": "deny",
          "rm -rf ~/*": "deny",
          "rm -rf .": "deny",
          "rm -rf .git": "deny",
          "rm -rf .git/*": "deny",
          "chmod 777 *": "deny",
          "chmod +s *": "deny",
          "chmod u+s *": "deny",
          "chown root *": "deny",

          "git push --force": "deny",
          "git push --force *": "deny",
          "git push * --force": "deny",
          "git push * --force *": "deny",
          "git push -f": "deny",
          "git push -f *": "deny",
          "git push * -f": "deny",
          "git push * -f *": "deny",
          "git reset --hard": "deny",
          "git reset --hard *": "deny",
          "git clean -fd": "deny",
          "git clean -fd *": "deny",
          "git clean -fdx": "deny",
          "git clean -fdx *": "deny",
          "git apply --unsafe-paths *": "deny",
          "git checkout *": "deny",
          "git switch *": "deny",
          "git branch -D": "deny",
          "git branch -D *": "deny",
          "git branch --force-delete": "deny",
          "git branch --force-delete *": "deny",

          "gh repo delete": "deny",
          "gh repo delete *": "deny",
          "gh repo rename": "deny",
          "gh repo rename *": "deny",
          "gh pr close": "deny",
          "gh pr close *": "deny",
          "gh pr merge": "deny",
          "gh pr merge *": "deny",
          "gh pr edit": "deny",
          "gh pr edit *": "deny",
          "gh pr create": "deny",
          "gh pr create *": "deny",
          "gh issue close": "deny",
          "gh issue close *": "deny",
          "gh issue delete": "deny",
          "gh issue delete *": "deny",
          "gh issue edit": "deny",
          "gh issue edit *": "deny",
          "gh release create": "deny",
          "gh release create *": "deny",
          "gh release delete": "deny",
          "gh release delete *": "deny",
          "gh auth login": "deny",
          "gh auth logout": "deny",
          "gh auth switch": "deny",
          "gh auth setup": "deny",

          "sudo *": "deny",
          "su *": "deny",
          "doas *": "deny",
          "pkexec *": "deny",
          "chroot *": "deny",
          "nsenter *": "deny",

          "ssh *": "deny",
          "scp *": "deny",
          "rsync *": "deny",
          "nc *": "deny",
          "netcat *": "deny",
          "ncat *": "deny",
          "socat *": "deny",
          "telnet *": "deny",
          "nmap *": "deny",

          "curl * --data *": "deny",
          "curl * -d *": "deny",
          "curl * -F *": "deny",
          "curl * --upload-file *": "deny",
          "curl * -T *": "deny",
          "wget * --post-data *": "deny",
          "wget * --post-file *": "deny",

          "cat .env": "deny",
          "cat .env.*": "deny",
          "cat */.env": "deny",
          "cat */.env.*": "deny",
          "cat ~/.ssh/*": "deny",
          "cat ~/.aws/*": "deny",
          "cat ~/.config/gh/*": "deny",
          "cat /etc/shadow": "deny",
          "cat /etc/passwd": "deny",
          "printenv": "deny",
          "printenv *": "deny",
          "tar * ~/.ssh*": "deny",
          "tar * ~/.aws*": "deny",
          "tar * .env*": "deny",

          "vim -c *": "deny",
          "vi -c *": "deny",
          "nvim -c *": "deny",
          "ex -c *": "deny",
          "find * -exec *": "deny",
          "find * -execdir *": "deny",
          "xargs * sh *": "deny",
          "xargs * bash *": "deny",
          "xargs * -I* sh *": "deny",
          "awk * system(*": "deny",
          "gawk * system(*": "deny",
          "mawk * system(*": "deny",

          "python -c *": "deny",
          "python2 -c *": "deny",
          "python3 -c *": "deny",
          "perl -e *": "deny",
          "ruby -e *": "deny",
          "node -e *": "deny",
          "php -r *": "deny",
          "lua -e *": "deny",
          "tclsh * eval *": "deny",

          "base64 -d *": "deny",
          "base64 --decode *": "deny",
          "eval *": "deny",
          "sh -c *": "deny",
          "bash -c *": "deny",
          "bash -i *": "deny",
          "zsh -c *": "deny",
          "* | sh": "deny",
          "* | sh *": "deny",
          "*|sh": "deny",
          "*|sh *": "deny",
          " *|sh": "deny",
          " *|sh ": "deny",
          "* | bash": "deny",
          "* | bash *": "deny",
          "*|bash": "deny",
          "*|bash *": "deny",
          " *|bash": "deny",
          " *|bash ": "deny",
          "* | python*": "deny",
          "*|python*": "deny",
          " *|python*": "deny",

          "docker run *": "deny",
          "docker exec *": "deny",
          "docker build *": "deny",
          "podman run *": "deny",
          "podman exec *": "deny",
          "kubectl exec *": "deny",
          "kubectl run *": "deny",

          "crontab *": "deny",
          "systemctl *": "deny",
          "launchctl *": "deny",
          "dd *": "deny",
          "mkfs *": "deny",
          "fdisk *": "deny",
          "mount *": "deny",
          "umount *": "deny",
          "kill -9 *": "deny",
          "killall *": "deny",
          "pkill *": "deny",
          "reboot": "deny",
          "shutdown *": "deny",
          "halt": "deny",

          "npm publish": "deny",
          "npm publish *": "deny",
          "yarn publish": "deny",
          "yarn publish *": "deny",
          "pnpm publish": "deny",
          "pnpm publish *": "deny",
          "cargo publish *": "deny",
          "gem push *": "deny",
          "pip upload *": "deny",
          "twine upload *": "deny"
        }
      }
    }
  }
}
